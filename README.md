# Automating-Splunk-With-N8N

## Overview 
This project is an end-to-end SOC automation pipeline that demonstrates how modern security operations team automate triage, enrichment, and notification workflow using:

- Splunk (Detection)
- N8N (Orchestration)
- OpenAI (AI assisted triage)
- Slack (Alert delivery to analysts)

## Project Goal

**Build a fully automated workflow that:**

1. Detects security events in Splunk
2. Sends alerts to N8N through a webhook
3. Automatically triggers AI-powered triage using OpenAI
4. Enriches IOCs (IP / Hash) using AbuseIPDB & Virustotal
5. Sends a structured triage to a Slack channel which analysts can view

## Outcome

By completing this Proof of Concept, we demonstrate how SOC automation can:

- Reduce analyst time spent on repetitive enrichment
- Deliver consistent, structured triage reports
- Deliver alerts to Slack and instantly alert analysts

## Lab Enviroment 

| Component / Role             | Description                          | IP Address      |
| ---------------------------- | ------------------------------------ | --------------- |
| **Windows 10 Endpoint**      | Target machine sending Sysmon logs   | `192.168.1.100` |
| **Splunk Server**            | SIEM for log ingestion + alerts      | `192.168.1.9`   |
| **N8N Orchestration Server** | SOAR platform receiving webhooks     | `192.168.1.12`  |


## Setup and Configuration 

### Splunk

**What is it?**
Splunk is a Security Information Events Manager (SIEM) used to collect and index logs multiple devices (firewalls, Endpoints, Routers, etc) to enable search, correlation and monitoring all on a single interface. 

**Use Case:**
In this project we will set up an alert for Event ID 4625. Splunk will then forward this alert to N8N via a webhook which will then be forwarded to additional nodes. 

**Configuration:**

- Installed Splunk enterprise on a machine with the static IP of **192.168.1.9** on Ubuntu 24.04.2 live server (*Figure 1*).
- Installed Splunk Add-on for Microsoft Windows
- Splunk Universal Forwarder was setup for the **Windows 10 Endpoint**
- Forwarders were configured to send logs to Splunk via tcp port 9997 to the Splunk Server (*Figure 2*).
- Created a Search Query to look for failed logon attempts and saved it as an alert (*Figure 3*)
- Configured the Alert to work as a webhook and forward this over to N8N (*Figure 4*)

**Splunk Screenshots:**

<p align="center">
  <img width="300" height="250" alt="image" src="https://github.com/user-attachments/assets/85ea4d67-d103-4421-8bd5-df3cefee9790" />
</p>
<p align="center"><b>Figure 1: Static IP configuration </b></p>

<p align="center">
  <img width="1300" height="200" alt="image" src="https://github.com/user-attachments/assets/0666940a-2ada-495a-ae5d-0b91a01c1d57" />
</p>
<p align="center"><b>Figure 2: Splunk Recieving Port 9997 setup for Universal Forwarders to send logs to</b></p>

<p align="center">
  <img width="600" height="50" alt="image" src="https://github.com/user-attachments/assets/ee957e75-81ba-43dd-bf2b-4968c1c66b09" />
</p>
<p align="center"><b>Figure 3: Splunk Search Query for failed Logon Attempts</b></p>

<p align="center">
  <img width="1061" height="194" alt="image" src="https://github.com/user-attachments/assets/5ee46ba6-d61f-465f-ad6f-f661250b107f" />
</p>
<p align="center"><b>Figure 4: Splunk alert configured to trigger webhook forwarding to N8N</b></p>


### Windows 10 Endpoint

**What is it:**

The windows 10 machine served as domain-joined endpoint and is used for generating user activity, authentication logs, and endpoint telemetry for monitoring and detection 

**Use Case:**
A Windows 10 Endpoint was configured within the LAN to able to forward logs (including failed authentication attempts) over to our spunk server. This machine was also used to access the N8N UI for configuring workflow nodes and setup the slack channele for recieving alerts generated by OpenAI.

**Configuration:**

- Configured with a static IP address of 192.168.1.100
- Joined the domain sam-ad.local
- Installed Splunk Universal Forwarder
  - Configured forwarder to send Windows Security and Sysmon logs to the Splunk Indexer (192.168.1.9) via TCP port 9997
- Configured the "inputs.conf" file to specify which logs to forward and which index to send them to (*Figure 5*)


**Windows 10 Endpoint Screenshots:**

<p align="center">
  <img width="499" height="378" alt="image" src="https://github.com/user-attachments/assets/a498d403-25c2-489c-b598-795e5f686ab7" />
</p>
<p align="center"><b>Figure 5: Inputs.conf configured to define log sources and destination Index.</b></p>


### N8N 

**What is it?**
N8N is an open-source workflow automation platform designed to connect applications, services, and data sources to automate repetitive tasks. 

**Use Case:**
In this project N8N is used (using Ubuntu Live Server) to automate the process of repetive tasks with analysing alerts created by splunk and perform enrichment with IP Addresses and Hashes using IPDBAbuse and VirusTotal. 

**Configuration**
- Installed Docker & Docker-compose
- Created docker-compose.yml to install the latest version if N8N(*Figure 6*)
- Deployed N8N
- Configured Webhook to recieve alerts from splunk (*Figure 7*)
- Build Automation Workflow (*Figure 8*)

### N8N Screenshots 

<p align="center">
  <img width="357" height="215" alt="image" src="https://github.com/user-attachments/assets/affab095-c7ed-4fa7-ad29-152e0cc234ae" /> 
</p>
<p align="center"><b>Figure 6: Docker-compose.yml script to install the latest version of N8N from Docker Hub</b></p>


<p align="center">
  <img width="1630" height="533" alt="image" src="https://github.com/user-attachments/assets/f94aace6-d232-4f7e-8f55-ddbf133750b7" />
</p>
<p align="center"><b>Figure 7: N8N Webhook sucessfully recieving Splunk Alert.</b></p>

<p align="center">
  <img width="664" height="389" alt="image" src="https://github.com/user-attachments/assets/89fc67eb-d5ca-44df-b607-a5041f5bc332" />
</p>
<p align="center"><b>Figure 8: N8N Automation Workflow intergrating Webhook Ingestion, AI Analysis, IOC/Hash Enrichment, and Slack Notification</b></p>


### N8N Open AI Configuration 

#### **Overview:**

This section covers the workflow, more specifically the OpenAI's Message a Model Node to to automatically analyse incoming Splunk Alert. The goal is to replicate the actions of a tier 1 SOC analyst by summarising the alert, enriching indicators, mapping MITRE ATT&CK techniques, and generating recommended next steps. 

**Prompt Engineering

to ensure consistent and structured output, multiple propmts were configured

1. **Assistent Prompt**

This prompt instructs the LLM to behave like a Tier 1 SOC Analyst. It performs:
- Alert Summarisation
- IOC Enrichment (IP or File Hash)
- MITRE ATT&CK mapping
- Recommended Actions
- It also specifies which tools the model should use (AbuseIPDB for IPs, and VirusTotal fir Hashes)

2. **User Prompt**

This prompt controls Splunks data being passed into the LLM (*Figure 9*)

3. **System Prompt**

This Prompt controls the formating ensuring OpenAI returns structured triage report, using the following format (*Figure 10*):
- Summary
- IOC Enrichment
- Severity Assesment
- Recommended Actions 

### N8N Open AI Configuration Screenshots

<p align="center">
  <img width="800" height="400" alt="image" src="https://github.com/user-attachments/assets/8d8884f4-3e45-4413-b29e-26d9dd124f67" />
</p>
<p align="center"><b>Figure 9: User Prompt configuration, converting Splunk Alert fields into Structured JSON for AI Analysis.</b></p>

<p align="center">
  <img width="277" height="167" alt="image" src="https://github.com/user-attachments/assets/0ab22b2b-8a1f-4d05-b7c6-6232659cfbdd" />
</p>
<p align="center"><b>Figure 10: System Prompt configuration ensuring OpenAI returns a Structured Triage Report.</b></p>

### Tooling Intergration 

Our Open AI node uses two additional enrichment tools which include:
- AbuseIPDB Lookup Tool - This is used to enrich and score external IP Addresses by querying the AbuseIPDB API for reputation scores and threat classification. 
- VirusTotal Hash Lookup Tool - This is used to analyse any suspicious file hashes found in the alert
  - These tools are directly refferenced in the Assistant Prompt so it knows when to use it.
    - Though we won't find Hashes in failed Logons we can hardcode a file hash as a proof of concept to demonstrate that OpenAI can automatically query VirusTotal using its API and Generate a report on this.
   
### Slack Intergration 

**Overview**:
Slack was intergrated into the automation workflow to deliver real-time triage reports generated by OpenAI. This allows alerts to be pushed to analysts in a central communication channel, replicating how modern SOC teams receive automated notifications. 

**Configuration:**

- A new Slack workspace (named **SOC-Project**) was created specifically for SOC Alerting
- A dedicated channel (called **splunk-alerts**) was setup to recieve automated notifications
- A Slack App was created to generate the OAuth Bot token used by N8N to authenitcate and send messages into the Slack Channel.
- The bot was added to the alerting channel to allow message posting. 

**N8N Slack Node Setup:**

- The **Send a Message** node was added to the workflow
- Slack OAuth token was stored inside N8N credentials.
- The output from the OpenAI node was passed directly into the Slack message body.


## Results Analysis 

### Malicious IP Address Analysis 

For testing purposes, following IP Address (173.244.55.102) was hardcoded into the user prompt. This allows us to validate that the OpenAI node can correctly idenitfy, enrich, and analyse malicious IOCs even though our virtual machine is not exposed to the internet (*Figure 11*). 

This IP Address was obtained from AbuseIPDB, where it is associated with multiple abuse categories. 

**Results:**

Upon executing our entire automation workflow a Slack message was sent to the soc-alerts channel by our bot (*Figure 12*). 
- From the slack message we can see that IP Enrichment was sucessful providing us with a confidence score and how many times it has been reported.
- A severity assesment was generated automatically based on the IOC and alert context
- Recommended actions were produced, giving clear investigative adn containment steps

Ultimately this confirms that the end to end automation sequence - From Splunk -> N8N -> OpenAI -> Slack - executed correctly and produced a fully enriched triage report without human interaction. 


### Malicious File Hash 

For testing purposes, a file hash was hardcoded into our user prompt. Mainly becuase with failed logons we will not get File Hashes (*Figure 13*). This File Hash was obtained from [the DFIR Report  ](https://thedfirreport.com/)

Upon executing our entire automation workflow a slack message was sent to the soc-alerts channel by our bot (*Figure 14*)
- From the Slack message we can see that the File Hash Enrichemnt was sucessful, providing us detail from VirusTotal into the capabilites into the file.
- The automation pipeline correctly identified the file as malicious and returned threat classifications, Anti Virus detections, and overall risk context associated with the hash. 



### Results Analysis Screenshots

<p align="center">
  <img width="302" height="159" alt="image" src="https://github.com/user-attachments/assets/4fe2d54f-6c13-4a4b-a4ce-746ce6d46a6d" />
</p>
<p align="center"><b>Figure 11: User Prompt Configuration showing hard-coded malicious IP for enrichment testing.</b></p>


<p align="center">
  <img width="1256" height="540" alt="image" src="https://github.com/user-attachments/assets/c2d911d6-675e-4774-9a56-9dcb54a6d6c9" />
</p>
<p align="center"><b>Figure 12:Final AI-Generated Triage Report Delivered to Slack via N8N Automation for malicious IP Address Workflow</b></p>


<p align="center">
  <img width="305" height="135" alt="image" src="https://github.com/user-attachments/assets/9af8b5e7-4e44-4fda-9372-b185794083f8" />
</p>
<p align="center"><b>Figure 13: User Prompt Configuration showing hard-coded File Hash obtained.</b></p>


<p align="center">
  <img width="1266" height="470" alt="image" src="https://github.com/user-attachments/assets/f16e311d-96f9-489c-9e8e-678c88b3fb2a" />
</p>
<p align="center"><b>Figure 14: Final AI-Generated Triage Report Delivered to Slack via N8N Automation for malicious File Hash.</b></p>


## Conclusion

This project sucessfully demonstrated how a modern SOC can leverage automation, AI, and enrichment tooling to accelerate incident traige and improve response efficiency. By intergrating Splunk, N8N, OpenAI, AbuseIPDB, and VirusTotal, we built an end-to-end pipelinecapable of transforming raw security events into fully enriched, structured, and actionable reports. 

The workflow processed both Netowork-Based IOCs and File-Based IOCs automatically generating severity assessments, MITRE ATT&CK mappings and recommended response actions. This ultimately reduces analyst workload, improves consistency in triage, and enable faster visibility inro potential threats.
